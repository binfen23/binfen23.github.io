---
title: 微信通知推送服务
description: 
date: 2025-10-25 13:06:37 +0800
categories: []
tags: [api,通知推送]
pin: false
math: false
mermaid: false
---
## 利用企业微信号（推荐）  
手机登陆企业微信（完成各种验证绑定，可以个人身份，不需要企业）
然后创建群聊，右上角三个点，添加群机器人，记得复制webhook地址
如果忘记复制，在群聊，右上角，机器人，点击机器人，可以复制webhook地址

然后电脑访问[https://work.weixin.qq.com/wework_admin/frame#profile/wxPlugin](https://work.weixin.qq.com/wework_admin/frame#profile/wxPlugin)

在 我的企业-微信插件，往下拉有个 邀请关注，那个二维码关注后，就可以不用企业微信，普通微信收信息。

发送普通文本消息（url需要改成webhook地址）：

```python

import json
import urllib.parse
import urllib.request

def send_message():
    url = 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxxxxxxx'

    data = {
        "msgtype": "text",
        "text": {
            "content": "通知内容"
        }
    }

    headers = {'Content-Type': 'application/json'}

    data = json.dumps(data).encode('utf-8')

    req = urllib.request.Request(url, data=data, headers=headers)
    with urllib.request.urlopen(req) as response:
        result = response.read().decode('utf-8')
        print(result)

send_message()

```  

------  

## 利用微信测试号   

进入测试号的网站
[https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login](https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login)

微信扫码登陆后，可以看到
appID和appsecret

这个是获取access_token需要用到的必要参数

或者access_token的api是：
`https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=这个改成appID的值&secret=这个改成appsecret`

**有效期是2小时，需要重复获取，每天2000次**

然后在测试号的网站往下拉，可以新建模板。
模板标题会在推送的标题显示，内容是文本，要设置参数的话就需要加上{{变量名.DATA}}

例如

测试内容：{{msgdata.DATA}}

在post请求的时候，msgdata参数的值就会替换进去。

然后需要记录 模板ID 值

然后有个测试号二维码，用微信扫码关注后，刷新网页，就可以看到openid（用户的id值）需要记录下来



发送消息:

api地址是：`https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=accesstoken值`
请求值是：
```
data = {
    "touser":"这里填写关注测试号后的用户ID",
    "template_id":"这里填写模板的ID值",
    "data": {
          "msgdata": {
            "value": "这是要推送的内容"
          },
    }
}
```

群发文本：

api地址是：`https://api.weixin.qq.com/cgi-bin/message/mass/sendall?access_token=accesstoken值`  
请求值是：
```
data = {
   "filter":{
      "is_to_all":True,
      "tag_id":2
   },
   "text":{
      "content":"这是我测试的内容哦"
   },
    "msgtype":"text"
}

```

