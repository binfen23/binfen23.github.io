---
title: win10开启远程桌面
description: 
date: 2025-10-24 13:05:31 +0800
categories: []
tags: [win10,远程桌面]
pin: false
math: false
mermaid: false
---
  ### 添加注册表 Remote Desktop Protocol (RDP) 使用的默认端口号
  `reg add "HKLM\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /t   REG_DWORD /v portnumber /d 3389 /f  `
  
  ### 开启远程桌面服务Remote Desktop Services
`net start termservice`

  ### 关闭远程桌面服务Remote Desktop Services
  `net stop termservice`

  ### 开启远程桌面
  `wmic RDTOGGLE WHERE ServerName='%COMPUTERNAME%' call SetAllowTSConnections 1`

  ### 关闭远程桌面
  `wmic RDTOGGLE WHERE ServerName='%COMPUTERNAME%' call SetAllowTSConnections 0`

  ### 检查端口状态
  `netstat -an|find "3389"`

  ### 允许空密码登陆
  开始 --- 运行 （win+R) --- secpol.msc --- 安全设置 --- 本地策略 --- 安全选项 --- 帐户：使用空密码的本地帐户只允许进行控制台登录 --- 双击 --- 选择 “已禁用”
  
  #解决 系统管理员不允许使用保存的凭据登录远程计算机
  win+r 在运行中输入 gpedit.msc，启动本地组策略编辑器
  计算机配置 - 管理模板 - 系统 - 凭据分配，打开右边窗体的“允许分配保存的凭据用于仅 NTLM 服务器身份验证”
  点击 已启用  ，在下方的  [将服务器添加到列表：【显示】]  ，点击显示，输入值为：*
  将 OS 默认值与上述输入连接起来 勾选去掉
  确定

  #解决 你不能访问此共享文件夹,因为你组织的安全策略组织未经身份验证的来宾访问。
  win+r 在运行中输入 gpedit.msc，启动本地组策略编辑器
  计算机配置-管理模板-网络-Lanman工作站”这个节点，在右侧内容区可以看到“启用不安全的来宾登录”改为 已启用
  
  如果不行需要修改注册表：
  win+R  在运行中输入regedit，
  计算机\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters，将AllowInsecureGuestAuth设置为1
  计算机\HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\LanmanWorkstation，将AllowInsecureGuestAuth设置为1


### 一键启动远程桌面脚本 
```bat
    @Echo off
    Set SERVER=192.168.10.175
    #如果远程的服务器是通过端口映射来区分服务器的时候使用
    Set Port=3312
    Set USERNAME=Administrator
    Set PASSWORD=55555
    #提前清除凭证，以防之前已有同名的凭证
    Cmdkey /delete:TERMSRV/%SERVER%
    #等待1秒
    Timeout 1
    #注册凭证
    Cmdkey /generic:TERMSRV/%SERVER% /user:%USERNAME% /pass:%PASSWORD%
    Start mstsc /v:%SERVER%:%Port%
    #等待1秒
    Timeout 1
    #删除凭证
    Cmdkey /delete:TERMSRV/%SERVER%
```

------  


```bat  
@echo off
:: 提升权限以管理员身份运行
>nul 2>&1 "%SYSTEMROOT%\system32\cacls.exe" "%SYSTEMROOT%\system32\config\system"
if '%errorlevel%' NEQ '0' (
    echo 请求管理员权限...
    goto :UACPrompt
) else ( goto :AdminAccess )

:UACPrompt
    echo Set UAC = CreateObject^("Shell.Application"^) > "%temp%\getadmin.vbs"
    echo UAC.ShellExecute "%~s0", "", "", "runas", 1 >> "%temp%\getadmin.vbs"
    "%temp%\getadmin.vbs"
    exit /B

:AdminAccess
    if exist "%temp%\getadmin.vbs" ( del "%temp%\getadmin.vbs" )

:: 启用远程桌面
echo 正在启用远程桌面...
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f

:: 允许防火墙规则（允许远程桌面）
echo 正在配置防火墙规则...
netsh advfirewall firewall set rule group="remote desktop" new enable=Yes

:: 检查当前远程桌面端口
echo 正在检查当前远程桌面端口...
for /f "tokens=3" %%A in ('reg query "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v PortNumber') do (
    set /a port=%%A
)
echo 当前远程桌面端口为：%port%

:: 如果需要更改远程桌面端口，请取消注释以下部分，并将 3390 替换为你希望的端口号
:: echo 正在更改远程桌面端口为 3390...
:: reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v PortNumber /t REG_DWORD /d 3390 /f
:: echo 正在添加新的防火墙规则...
:: netsh advfirewall firewall add rule name="Open Port 3390 for RDP" dir=in action=allow protocol=TCP localport=3390

echo 配置完成！
pause  
```  

  

### 以上脚本均待测试..