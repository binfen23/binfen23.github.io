---
title: serv00玩法
description: 
date: 2025-10-25 14:44:24 +0800
categories: []
tags: [serv00]
pin: false
math: false
mermaid: false
---
## 保活  

脚本名不能改，代码内引用了，改了后脚本会有错误

先在网页面板，创建一个子域名，选择nodejs 版本选择node.jsV22.9.0
然后打开网页file mannager，在domains找到刚刚创建的子域名

进入 public_nodejs ，将public文件夹名字改掉或者删除，因为存在这个文件夹名的话，默认会显示html，而不是执行我们要的app.js
然后在 public_nodejs 文件夹内，上传app.js

然后将 keepalive.sh 保活脚本，放在home目录内

最后通过get请求子域名。返回状态码为500，就成功了，此时可以通过ps aux查看运行情况  

app.js：
```nodejs
const exec = require("child_process").exec;

exec(`nohup $HOME/keepalive.sh >/dev/null 2>&1 &`, (err) => {
  if (err) {
    console.log(`Keep alive error}`);
  } else {
    console.log(`Keep alive success`);
  }
});

```

keepalive.sh：
```shell
#!/bin/bash

# 执行 pgrep 命令并获取输出
output=$(pgrep -laf "keepalive.sh")

# 计算输出的行数
line_count=$(echo "$output" | wc -l)

# 判断行数
if [ "$line_count" -gt 1 ]; then
    echo "$(date +'%Y-%m-%d %H:%M:%S') - 脚本已经在运行，退出新实例。"
    exit 1
else
    echo "开始执行脚本"
fi


# 检查并启动 frp 进程
check_and_start_frp() {
    local result=$(pgrep -laf "frp")
    if [ -z "$result" ]; then
        echo "$(date +'%Y-%m-%d %H:%M:%S') - frp 启动!!"
        nohup $HOME/frp/frps -c $HOME/frp/frps.toml >/dev/null 2>&1 &
    else
        local pid=$(echo "$result" | awk '{print $1}')
        echo "$(date +'%Y-%m-%d %H:%M:%S') - frp 运行中...  PID: $pid"
    fi
}

# # 杀死 php-fpm 进程
# kill_php_fpm() {
#     local result=$(pgrep -laf "php-fpm")
#     if [ -z "$result" ]; then
#         echo "$(date +'%Y-%m-%d %H:%M:%S') - php-fpm 没有运行..."
#     else
#         echo "$result" | while read -r line; do
#             local pid=$(echo "$line" | awk '{print $1}')
#             echo "$(date +'%Y-%m-%d %H:%M:%S') - 杀死 php-fpm 进程...  PID: $pid"
#             kill $pid
#         done
#     fi
# }

# 杀死 node 进程
kill_node() {
    local result=$(pgrep -laf "node")
    if [ -z "$result" ]; then
        echo "$(date +'%Y-%m-%d %H:%M:%S') - node 没有运行..."
    else
        local pid=$(echo "$result" | awk '{print $1}')
        echo "$(date +'%Y-%m-%d %H:%M:%S') - 杀死 node 进程...  PID: $pid"
        kill $pid
    fi
}

# 主函数
main() {
    while true
    do
        echo "======"
        check_and_start_frp
        kill_node
        sleep 300
    done
}

# 调用主函数
main
```  


------  

## 安装节点  
一键安装

之后就cat serv00_hy2.txt 来获取节点信息

以下启动节点服务器
nohup ${HOME}/.hy/hy server -c ${HOME}/.hy/config.yaml > ${HOME}/.hy/hy.log 2>&1 &  

setup_hy.sh：  

```shell
#!/bin/bash

# 下载并重命名Hysteria2二进制文件
HYSTERIA_URL="https://github.com/apernet/hysteria/releases/download/app%2Fv2.6.0/hysteria-freebsd-amd64"
HYSTERIA_BINARY="${HOME}/.hy/hy"

# 创建目录
mkdir -p ${HOME}/.hy

# 下载Hysteria2二进制文件
curl -L -o ${HYSTERIA_BINARY} ${HYSTERIA_URL}
if [ $? -ne 0 ]; then
  echo "下载Hysteria2二进制文件失败，请检查网络连接或URL。"
  exit 1
fi

# 赋予执行权限
chmod +x ${HYSTERIA_BINARY}

# 设置端口，默认为22333
export PORT=${PORT:-'22333'}

# 获取服务器的公网IP地址
export MYIP=$(curl -s --max-time 1.5 ipv4.ip.sb)
if [ -z "$MYIP" ]; then
  echo "无法获取服务器的公网IP，请检查网络连接或防火墙设置。"
  exit 1
fi

# 创建证书和私钥
mkdir -p ${HOME}/.hy
openssl req -x509 -nodes -newkey ec:<(openssl ecparam -name prime256v1) -keyout "${HOME}/.hy/server.key" -out "${HOME}/.hy/server.crt" -subj "/CN=bing.com" -days 36500

# 生成UUID
export UUID=$(openssl rand -hex 16 | sed 's/\(..\)/\1/g' | sed 's/\(........\)\(....\)\(....\)\(....\)\(............\)/\1-\2-\3-\4-\5/')

# 配置文件内容
cat << EOF > ${HOME}/.hy/config.yaml
listen: $MYIP:$PORT

tls:
  cert: "${HOME}/.hy/server.crt"
  key: "${HOME}/.hy/server.key"

bandwidth:
  up: 1 gbps
  down: 1 gbps

auth:
  type: password
  password: "${UUID}"

fastOpen: true

masquerade:
  type: proxy
  proxy:
    url: https://bing.com
    rewriteHost: true

transport:
  udp:
    hopInterval: 30s
EOF

# 使用nohup启动Hysteria2服务
nohup ${HYSTERIA_BINARY} server -c ${HOME}/.hy/config.yaml > ${HOME}/.hy/hy.log 2>&1 &

# 输出连接信息
echo "hysteria2://${UUID}@${MYIP}:${PORT}/?sni=www.bing.com&alpn=h3&insecure=1#serv00_hy2"

# 保存连接信息
echo "hysteria2://${UUID}@${MYIP}:${PORT}/?sni=www.bing.com&alpn=h3&insecure=1#serv00_hy2" > $HOME/serv00_hy2.txt

exit 0

```